def xor_two_strings(s1, s2):
    return bytes(a ^ b for a, b in zip(s1, s2))

def xor_all(cipher_list, ks):
    plaintexts=[]
    for c in cipher_list:
        plaintext=b''
        for i in range(len(ks)):
            if i >= len(c):
                break
            t=c[i] ^ ks[i]
            plaintext+=bytes([t])
            if not 32 <= t <= 126:
                return False
        plaintexts.append(plaintext)

    return plaintexts
import requests
import string
url='https://aes.cryptohack.org/stream_consciousness/encrypt/'
cipher_list=[b'\x9esNB\x07\x9a\x04f\x9bfp\x0f\xf7\x83\xdaaw{{\xc5u\xd3\xb0\x16\xb4$\x89\x83c\x8c\x1b\xbeR\xea:\x0f\xf5M\xbe\xf4%\xda\xe5\xc2\xcc\xe8\x16\xe4O\xc8\xb0^\xe3\xf7j\x80\xf1\x13z\x9f\x84>\x162c\xe4\xe5\xc2\xf0\x9f\xcc\xaa%\xb9\xec\xd4\xe9X)\xc4a(\x84\xa4\x03\xa3>=N1\x06\xad\xc7*1F~\xd6\xc6V', b'\x8dt[\x0e\x1a\xd5S{\x9fo)[\xf8\x85\x94e9/c\xc5h\x9d\x8dX\xb7c\xc5\x87l\x9eR\xb2@\xa37K\xefF\xba\xbb*\xd2\xa9\x8a\xcd\xf3\x11\xa5U\xc5\xfdZ\xb2', b'\x9enG]\r\x97\x1en\x9cc>\x1c\xbf\x8b\xdanwBz\xc8m\x9a\x97T\xab}', b'\x94s\x0e\x0e7\x9d\x1fc\xd7m?[\xf6\x84\x94~8/W\xcbm\x9f\x80\x11\xb8j\x81\xc6v\x9f\x1e\xbc\x15\xa2>]\xa6[\xa9\xe9*\xd7\xa2\xc2\xcd\xbb\x1b\xf0U', b'\x8etG]\x1b\x9a\x1b`\x85y5\x08\xb3\xca\xc0b>|3\xc7`\x81\x8bX\xb8c\x80\xc6/\xda\x1a\xbfB\xea\x12\x0f\xeaG\xbc\xef#\xdb\xe5\xc7\xc0\xe8\x11\xe9G\x8c\xf9Q\xad\xe7"\x9d\xeaRm\xde\x82$\x1a!a\xe7\xaa\x9d\xb5\xcb\xed\xef1\xeb\xed\xc5\xe9J0\xda$,\x94\xf7Z\xe6|!T1;\xe5\xd1b\'X}\x98\xcf\x1d\xef\xf8\x97\xd2\xe6K\x18\xef\r\x83\xfc\x04s)\n\x12]\xaf\x88', b'\x93h\x02M\x1f\xd4T{\xd7h5[\xeb\x85\xc6dw`f\xd0-\xd3\x9bD\xad$\x8c\x92"\x99\x13\xbe\x15\xa8>\x0f\xefO\xb3\xf49\xdb\xa1\x84', b'\x8dtCZ^\xdbSa\x96y$\x02\xbf\x99\xd9o;c3\xd0i\x9a\x8a\x11\xa9e\x8c\x88v\xda\x1a\xb1Q\xe4', b'\x8dsWB\x1a\x9a:/\x9fk&\x1e\xbf\x88\xd1f>je\xc1e\xd3\x8dY\xbcj\xc5\x92j\x9b\x06\xf0|\xea8@\xf3D\xb9\xbb9\xdb\xa4\xc9\xd1\xbb\x07\xf0B\xc4\xb0[\xe8\xe3>\x9c\xeaRa\xd9\xd0>\x06-o\xee\xe3\xd1\xe1\xd6\xea\xe4w', b'\x8etPK\x1b\x9a\x11`\x8eyp\t\xea\x84\xdac9h?\x84q\x9f\x98H\xb0j\x82\xc6c\x8eR\xb8Z\xb8(J\xf5\x04\xfd\xc8.\xcc\xbc\xc5\xc3\xf3\x15\xa4', b'\x8dtCZ^\xdbSc\x98~p\x14\xf9\xca\xc0b>at\xd7!\x87\x91P\xad$\x91\x8eg\x94R\xa3P\xaf6J\xe2\x08\xa9\xf4k\xd3\xa0\x8a\xca\xf4T\xe8@\xde\xe6Z\xe1\xff%\x81\xeaRo\xd1\x94v\x06.g\xf6\xfe\xd1\xfc\xd1\xe4\xe8$\xa9\xb3\x80\xa1J*\xd3$&\x98\xe7\x0e\xab{tI\x7f\x01\xac\xc5d/Rx\xdb\xc0\x16\xed\xb1\xc5\x93\xfbJ]\xbb\x11\x8e\xb9\x1d;!\x03\x14G\xe1\xef\xb6\x04]\x0c\x9eS_6b\xe8\xe3\xcd\x939y;\xe8\x9f7~.\xa0\xb2I\xa3(\x83d\xf5$\x0c\xf8\xac0 \x93\x04\xdbE\xec', b'\x98iV\x0e7\x9a\x04f\x9bfp\x08\xf7\x85\xc3*?f~\x8a', b'\x9bo\x02G\x18\x9a:/\x9fk4[\xfe\x84\xcd* f`\xcc!\x87\x96\x11\xbba\xc5\x8fl\xda\x06\xb8P\xea)F\xe1@\xa9\xbak\xf7\xe5\xc9\xd8\xf5S\xf1\x00', b'\x95iP\x11^\xed\x1bv\xd7e%\t\xa0', b'\x96sTKR\x9a\x03}\x98h1\x19\xf3\x93\x8b*\x03gv\xdd!\x97\x96_\xfep\xc5\x8dl\x95\x05\xf0]\xa5,\x0f\xe2Z\xb8\xfa9\xc7\xe5\xc3\xcd\xbb\x1d\xf6\r\x8c\xf8P\xfa\xb3"\x81\xf4\x1bb\xd6\x91"\x1a.a\xac\xa4\x9e\xb5\xcb\xed\xefh\x8d\xe9\xc5\xa7^9\x96e*\x99\xa4\x02\xaew8Dc\x17\xab\x8c', b'\xb9n[^\n\xd5\x08d\xc4seL\xed\xd9\x80g\x08} \xd14\xc0\xa6\x00\xec[\x83\xd25\xce\x1e\xad', b'\x8ayPF\x1f\xca\x00/\x9fop\x13\xfe\x99\x94g>|`\xc1e\xd3\x8dY\xbc$\x91\x94c\x93\x1c\xf0T\xa4?\x0f\xef[\xfd\xf9*\xdd\xae\x8a\xdb\xe2T\xebN\xdb\xbe\x1f\xda\xf2$\x80\xb9\x1fa\xcd\x95v\x1b5k\xeb\xe6\xd9\xf4\xcb\xec\xe5&\xed']
'''for i in range(32):
    response=requests.get(url).json()
    res=bytes.fromhex(response['ciphertext'])
    if res not in cipher_list:
        cipher_list.append(res)'''

flag=b'crypto{'
for c in cipher_list:
    ks=xor_two_strings(c[:len(flag)], flag)
    if xor_all(cipher_list, ks) is not False:
        print("Key found:", ks)
        encrypted_flag=c
        plaintexts=xor_all(cipher_list, ks)
        for i in range(len(plaintexts)):
            print(str(i) + '|' + plaintexts[i].decode())
        break
all_char=string.ascii_letters + string.digits + string.punctuation + ' '
def guess(idx, guess):
    global flag, plaintexts
    for i in all_char:
        candidate=flag+bytes([ord(i)])
        new_ks=xor_two_strings(encrypted_flag[:len(candidate)], candidate)
        a=xor_all([cipher_list[idx]], new_ks)
        if a is not False and a[0].decode().startswith(plaintexts[idx].decode()+guess):
            print("flag:", candidate)
            flag=candidate
            plaintexts=xor_all(cipher_list, new_ks)
            for i in range(len(plaintexts)):
                print(str(i) + '|' + plaintexts[i].decode())
            break
guess(3, 'l')
guess(0, 'l')
guess(0, 'l')
guess(6, 't')
guess(6, 'y')
guess(13, 'l')
guess(13, 'y')
guess(0, 'n')
guess(0, 'k')
guess(6, 'l')
guess(6, 'l')
guess(15, 's')
guess(7, 'e')
guess(15, 'd')
guess(3, 'l')
guess(3, 'y')
guess(15, 'h')
guess(15, 'e')
guess(13, 't')
guess(8, 'g')
guess(6, 'n')
guess(6, 't')
guess(13, 'o')
guess(13, 'w')
guess(6, 'a')
guess(6, 's')

